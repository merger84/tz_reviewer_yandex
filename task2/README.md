# Тестовое задание для ревьюера DE

## Задание 2. Что сделать

Используя API [exchangerate.host](https://exchangerate.host/) подготовьте ETL процесс с помощью Airflow на python, для выгрузки данных по валютной паре BTC/USD (Биткоин к доллару), выгружать следует с шагом 3 часа и записывать данные в БД (валютная пара, дата, текущий курс).

В качестве задания со звёздочкой можете учесть вариант заполнения базы историческими данными (API предоставляет специальный endpoint для выгрузки исторических данных).

**Уточнения по способам решения**

Напишите код на Python.
Для автоматического запуска выгрузки используйте Airflow любой версии.
База может быть любая удобная вам: MongoDB, Postgres, Clickhouse.
Оберните всё в контейнеры и запускайте с помощью docker-compose.

## Решение

Чтобы начать работу с кодом, запустите Airflow в Docker Compose с помощью следующей команды:

```
docker-compose up 
```

Docker Compose создаст Airflow и базу данных PostgreSQL. В Airflow добавиться connections c подключением к БД PostgreSQL.

Для связи с Postgres:
- Host: localhost
- Port: 5433
- Database: postgres
- Username: airflow
- Password: airflow

Перейти в веб-сервер Airflow по адресу http://localhost:8080

Запустите DAG: api_exchangerate

DAG будет выполняться раз в 3 часа, начиная с полуночи.
На первом шаге будут получены исторические данные из [exchangerate.host](https://exchangerate.host/) за указанный день. По умолчанию - это текущий день.

В случае отсутствия создастся таблица **price_desc**, с полями *сurrency_pair* - валютная пара, *price_date* - дата, *price* - текущий курс.

Данные подгружаются раз в сутки. Поэтому будем удалять данные за указанную дату и записывать новые данные.

В случае отсутствия данных в указанный день будет добавлена строка с указанной датой и пустым значением курса.
